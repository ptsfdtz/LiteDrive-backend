openapi: 3.0.3
info:
  title: LiteDrive API
  description: |
    LiteDrive åœ¨çº¿ç½‘ç›˜åç«¯ APIï¼ˆGo + Gin + S3ï¼‰

    ## åŠŸèƒ½ç‰¹æ€§
    - ğŸ” ç”¨æˆ·è®¤è¯ï¼ˆJWTï¼‰
    - ğŸ“ æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
    - ğŸ“‚ æ–‡ä»¶å¤¹ç®¡ç†
    - ğŸ—‚ï¸ æ–‡ä»¶åˆ—è¡¨/æœç´¢
    - ğŸ—„ï¸ S3 å…¼å®¹å­˜å‚¨ï¼ˆæ”¯æŒ MinIOï¼‰
    - ğŸ”’ ç”¨æˆ·éš”ç¦»ä¸æƒé™æ§åˆ¶

    ## è®¤è¯è¯´æ˜
    é™¤äº†å…¬å¼€ç«¯ç‚¹å¤–ï¼Œæ‰€æœ‰APIéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦JWT tokenï¼š
    ```
    Authorization: Bearer YOUR_JWT_TOKEN
    ```
  version: 1.0.0
  contact:
    name: LiteDrive Team
    url: https://github.com/ptsfdtz/LiteDrive
  license:
    name: MIT
servers:
  - url: http://localhost:8080
    description: æœ¬åœ°å¼€å‘ç¯å¢ƒ
paths:
  /health:
    get:
      summary: å¥åº·æ£€æŸ¥
      tags: [system]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /v1/auth/register:
    post:
      summary: ç”¨æˆ·æ³¨å†Œ
      tags: [auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "200":
          description: æ³¨å†ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
        "400":
          description: å‚æ•°é”™è¯¯æˆ–å†²çª
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/auth/login:
    post:
      summary: ç”¨æˆ·ç™»å½•
      tags: [auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT ä»¤ç‰Œï¼ˆBearerï¼‰
        "400":
          description: å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: è®¤è¯å¤±è´¥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/me:
    get:
      summary: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
      tags: [auth]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
        "401":
          description: æœªè®¤è¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: ç”¨æˆ·ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/files/upload:
    post:
      summary: æ–‡ä»¶ä¸Šä¼ 
      tags: [files]
      security:
        - bearerAuth: []
      parameters:
        - name: overwrite
          in: query
          description: æ˜¯å¦è¦†ç›–åŒåæ–‡ä»¶
          schema:
            type: boolean
            default: false
        - name: parent_id
          in: query
          description: çˆ¶æ–‡ä»¶å¤¹IDï¼ˆå¯é€‰ï¼Œä¼˜å…ˆçº§é«˜äºpathå‚æ•°ï¼‰
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: è¦ä¸Šä¼ çš„æ–‡ä»¶
                path:
                  type: string
                  description: ä¸Šä¼ è·¯å¾„ï¼Œé»˜è®¤ä¸ºæ ¹ç›®å½•
                  example: "/documents/"
                  default: "/"
                description:
                  type: string
                  description: æ–‡ä»¶æè¿°ï¼ˆå¯é€‰ï¼‰
                  maxLength: 500
                is_public:
                  type: boolean
                  description: æ˜¯å¦è®¾ä¸ºå…¬å¼€æ–‡ä»¶
                  default: false
      responses:
        "200":
          description: ä¸Šä¼ æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FileInfo"
        "400":
          description: å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: æœªè®¤è¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/files:
    get:
      summary: è·å–æ–‡ä»¶åˆ—è¡¨
      tags: [files]
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: é¡µç 
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: æ¯é¡µæ¡æ•°
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: path
          in: query
          description: æ–‡ä»¶å¤¹è·¯å¾„
          schema:
            type: string
            example: "/documents"
        - name: parent_id
          in: query
          description: çˆ¶æ–‡ä»¶å¤¹IDï¼ˆ0è¡¨ç¤ºæ ¹ç›®å½•ï¼‰
          schema:
            type: integer
            format: int64
            default: 0
        - name: type
          in: query
          description: æ–‡ä»¶ç±»å‹è¿‡æ»¤
          schema:
            type: string
            enum: [all, file, folder]
            default: all
        - name: search
          in: query
          description: æœç´¢å…³é”®è¯ï¼ˆæ–‡ä»¶åï¼‰
          schema:
            type: string
            maxLength: 100
        - name: sort_by
          in: query
          description: æ’åºå­—æ®µ
          schema:
            type: string
            enum: [name, size, created_at, updated_at]
            default: updated_at
        - name: sort_order
          in: query
          description: æ’åºé¡ºåº
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FileListResponse"
        "401":
          description: æœªè®¤è¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/files/{id}:
    get:
      summary: è·å–æ–‡ä»¶è¯¦ç»†ä¿¡æ¯
      tags: [files]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ–‡ä»¶ID
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FileInfo"
        "401":
          description: æœªè®¤è¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: æ–‡ä»¶ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    delete:
      summary: åˆ é™¤æ–‡ä»¶
      tags: [files]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ–‡ä»¶ID
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: åˆ é™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "file deleted successfully"
        "401":
          description: æœªè®¤è¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: æ–‡ä»¶ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/files/{id}/download:
    get:
      summary: ä¸‹è½½æ–‡ä»¶
      tags: [files]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: æ–‡ä»¶ID
          schema:
            type: integer
            format: int64
        - name: inline
          in: query
          description: æ˜¯å¦å†…è”æ˜¾ç¤ºï¼ˆè€Œéä¸‹è½½ï¼‰
          schema:
            type: boolean
            default: false
        - name: thumbnail
          in: query
          description: æ˜¯å¦è¿”å›ç¼©ç•¥å›¾ï¼ˆä»…æ”¯æŒå›¾ç‰‡ï¼‰
          schema:
            type: boolean
            default: false
        - name: quality
          in: query
          description: ç¼©ç•¥å›¾è´¨é‡ï¼ˆ1-100ï¼‰
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 80
      responses:
        "200":
          description: æ–‡ä»¶å†…å®¹
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "401":
          description: æœªè®¤è¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: æ–‡ä»¶ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/folders:
    post:
      summary: åˆ›å»ºæ–‡ä»¶å¤¹
      tags: [folders]
      security:
        - bearerAuth: []
      parameters:
        - name: recursive
          in: query
          description: æ˜¯å¦é€’å½’åˆ›å»ºçˆ¶ç›®å½•
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateFolderRequest"
      responses:
        "200":
          description: åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FileInfo"
        "400":
          description: å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: æœªè®¤è¯
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: æ–‡ä»¶å¤¹å·²å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    RegisterRequest:
      type: object
      required: [username, email, password]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 64
          example: alice
        email:
          type: string
          format: email
          example: alice@example.com
        password:
          type: string
          format: password
          minLength: 6
          maxLength: 64
          example: Passw0rd!
        nickname:
          type: string
          example: Alice
    LoginRequest:
      type: object
      properties:
        username:
          type: string
          example: alice
        email:
          type: string
          format: email
          example: alice@example.com
        password:
          type: string
          format: password
          example: Passw0rd!
      oneOf:
        - required: [username, password]
        - required: [email, password]
    UserInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        username:
          type: string
          example: alice
        email:
          type: string
          format: email
          example: alice@example.com
        nickname:
          type: string
          example: Alice
    Error:
      type: object
      properties:
        error:
          type: string
          example: message
    FileInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        created_at:
          type: string
          format: date-time
          example: "2025-10-14T14:37:56.591026+08:00"
        updated_at:
          type: string
          format: date-time
          example: "2025-10-14T14:37:56.591026+08:00"
        name:
          type: string
          example: "test.txt"
        path:
          type: string
          example: "/test.txt"
        size:
          type: integer
          format: int64
          example: 1024
          description: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
        mime_type:
          type: string
          example: "text/plain"
          description: MIME ç±»å‹
        hash:
          type: string
          example: "09e7ab13a4948b9625eb763391288c36"
          description: æ–‡ä»¶å“ˆå¸Œå€¼ï¼ˆMD5ï¼‰
        user_id:
          type: integer
          format: int64
          example: 1
        parent_id:
          type: integer
          format: int64
          example: 0
          description: çˆ¶æ–‡ä»¶å¤¹IDï¼Œ0è¡¨ç¤ºæ ¹ç›®å½•
        storage_path:
          type: string
          example: "files/1/09e7ab13a4948b9625eb763391288c36.txt"
          description: å­˜å‚¨è·¯å¾„
        is_dir:
          type: boolean
          example: false
          description: æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹
        is_public:
          type: boolean
          example: false
          description: æ˜¯å¦å…¬å¼€
    FileListResponse:
      type: object
      properties:
        files:
          type: array
          items:
            $ref: "#/components/schemas/FileInfo"
        page:
          type: integer
          example: 1
          description: å½“å‰é¡µç 
        limit:
          type: integer
          example: 20
          description: æ¯é¡µæ¡æ•°
        total:
          type: integer
          example: 100
          description: æ€»æ¡æ•°
    CreateFolderRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          example: "documents"
          description: æ–‡ä»¶å¤¹åç§°
          minLength: 1
          maxLength: 255
        path:
          type: string
          example: "/"
          description: çˆ¶è·¯å¾„
          default: "/"
        parent_id:
          type: integer
          format: int64
          description: çˆ¶æ–‡ä»¶å¤¹IDï¼ˆä¼˜å…ˆçº§é«˜äºpathå‚æ•°ï¼‰
          example: 0
        description:
          type: string
          description: æ–‡ä»¶å¤¹æè¿°
          maxLength: 500
        is_public:
          type: boolean
          description: æ˜¯å¦è®¾ä¸ºå…¬å¼€æ–‡ä»¶å¤¹
          default: false
